---
export interface Props {
  title: string;
  description?: string;
  image?: string;
  canonicalURL?: string;
  noindex?: boolean;
  type?: 'website' | 'article';
}

const {
  title,
  description = 'Ghi lại hành trình bộ hành tỉnh thức xuyên Việt Nam - một không gian số cho sự sống chậm và chiêm nghiệm',
  image = '/assets/logo.png',
  canonicalURL = new URL(Astro.url.pathname, Astro.site),
  noindex = false,
  type = 'website'
} = Astro.props;

const siteName = 'Bộ Hành Tỉnh Thức';
const fullTitle = title === siteName ? title : `${title} | ${siteName}`;

// Import global styles
import '../styles/global.css';
---

<!doctype html>
<html lang="vi" class="scroll-smooth">
  <head>
    <!-- Basic Meta Tags -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />
    
    <!-- SEO Meta Tags -->
    <title>{fullTitle}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />
    {noindex && <meta name="robots" content="noindex, nofollow" />}
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={fullTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(image, Astro.site)} />
    <meta property="og:site_name" content={siteName} />
    <meta property="og:locale" content="vi_VN" />
    
    <!-- Twitter Card -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={fullTitle} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={new URL(image, Astro.site)} />
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" href="/assets/logo.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/logo.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/logo.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/logo.png" />
    <link rel="shortcut icon" href="/assets/logo.png" />
    
    <!-- Preload Critical Resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://images.unsplash.com" />
    
    <!-- Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": siteName,
      "description": description,
      "url": Astro.site,
      "potentialAction": {
        "@type": "SearchAction",
        "target": `${Astro.site}?q={search_term_string}`,
        "query-input": "required name=search_term_string"
      },
      "author": {
        "@type": "Person",
        "name": "Người Bộ Hành"
      },
      "inLanguage": "vi-VN",
      "copyrightYear": new Date().getFullYear(),
      "genre": ["Travel", "Lifestyle", "Mindfulness", "Photography"]
    })} />
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#f9fafb" />
    <meta name="msapplication-TileColor" content="#f9fafb" />
    
    <!-- Performance Hints -->
    <meta name="format-detection" content="telephone=no" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    
    <!-- Import Global Styles -->
    <style>
      /* Critical CSS for above-the-fold content - Light Mode */
      body {
        background-image: url('/assets/images/walking.jpg');
        background-attachment: fixed;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        color: #1f2937;
      }
      
      /* Prevent flash of unstyled content */
      .glass-card {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(0, 0, 0, 0.1);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>
  
  <body class="bg-nature">
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 glass-card px-4 py-2 text-accent-color z-50">
      Bỏ qua để đến nội dung chính
    </a>
    
    <!-- Header -->
    <header>
      <slot name="header" />
    </header>
    
    <!-- Main Content -->
    <main id="main-content" role="main">
      <slot />
    </main>
    
    <!-- Footer -->
    <footer>
      <slot name="footer" />
    </footer>
    
    <!-- Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js').catch(err => {
            console.log('Service Worker registration failed: ', err);
          });
        });
      }
    </script>
    
    <!-- Analytics (placeholder for future implementation) -->
    <!-- Google Analytics or other analytics code can be added here -->
    
    <!-- CSS đã được inline bởi Astro để tối ưu performance -->
  </body>
</html>

<style>
  /* Screen reader only class */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
  
  .focus\:not-sr-only:focus {
    position: static;
    width: auto;
    height: auto;
    padding: inherit;
    margin: inherit;
    overflow: visible;
    clip: auto;
    white-space: normal;
  }
</style>
